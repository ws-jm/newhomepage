"use strict";var jQuery=jQuery||require("jquery");!function(){var e=function(e,d){var n=jQuery(e),o=this,i={};i.node_id=d.node_id,i.root_node=d.root_node,i.child_nodes=d.child_nodes,i.parent_node=d.parent_node,i.parent_nodes=function(e){var d=jQuery.Deferred(),n=[],o=function(e){i.parent_node(e).done(function(e){if(e){n.unshift(e);var r=i.node_id(e);o(r)}else d.resolve(n)})};return o(e),d};var r=d.render_node,t=function(e,d){var t=i.node_id(e);if(void 0===d)var l=n.find(".node-tree");else var l=n.find(".node[data-node="+d+"]").children(".node-children");var a=r(t,e);l.append(a);var c=n.find(".node[data-node="+t+"]");c.children(".node-body").find(".node-loading").hide(),c.children(".node-body").find(".node-loaded").hide(),c.children(".node-body").find(".node-not-loaded").show(),c.children(".node-body").find(".node-empty").hide(),c.children(".node-body").find(".node-not-empty").hide(),c.children(".node-children").hide(),c.children(".node-body").find(".node-expanded").hide(),c.children(".node-body").find(".node-collapsed").hide(),c.find("[data-collapse=node]").click(function(e){var d=jQuery(e.target).closest(".node"),n=d.data("node");o.collapse(n)}),c.find("[data-expand=node]").click(function(e){var d=jQuery(e.target).closest(".node"),n=d.data("node");o.expand(n)}),c.find("[data-select=node]").click(function(e){var d=jQuery(e.target).closest(".node"),n=d.data("node");o.select(n)})},l={},a=function(e){var d=l[e];if(d)return d;d=l[e]=jQuery.Deferred();var o=n.find(".node[data-node="+e+"]");return o.children(".node-body").find(".node-not-loaded").hide(),o.children(".node-body").find(".node-loaded").hide(),o.children(".node-body").find(".node-loading").show(),i.child_nodes(e).done(function(n){o.children(".node-body").find(".node-not-loaded").hide(),o.children(".node-body").find(".node-loading").hide(),o.children(".node-body").find(".node-loaded").show(),jQuery.isEmptyObject(n)?(o.children(".node-body").find(".node-not-empty").hide(),o.children(".node-body").find(".node-empty").show()):(o.children(".node-body").find(".node-empty").hide(),o.children(".node-body").find(".node-not-empty").show()),o.children(".node-children").hide(),o.children(".node-body").find(".node-expanded").hide(),o.children(".node-body").find(".node-collapsed").show();for(var i=0;i<n.length;i++){var r=n[i];t(r,e)}d.resolve()}).fail(function(){o.children(".node-body").find(".node-loaded").hide(),o.children(".node-body").find(".node-loading").hide(),o.children(".node-body").find(".node-not-loaded").show(),d.reject()}),d};this.unload_node=function(e){delete l[e];var d=n.find(".node[data-node="+e+"]");d.children(".node-children").empty(),d.children(".node-body").find(".node-loading").hide(),d.children(".node-body").find(".node-loaded").hide(),d.children(".node-body").find(".node-not-loaded").show(),d.children(".node-body").find(".node-empty").hide(),d.children(".node-body").find(".node-not-empty").hide(),d.children(".node-children").hide(),d.children(".node-body").find(".node-expanded").hide(),d.children(".node-body").find(".node-collapsed").hide()},this.collapse=function(e){var d=n.find(".node[data-node="+e+"]");d.children(".node-children").hide(),d.children(".node-body").find(".node-expanded").hide(),d.children(".node-body").find(".node-collapsed").show()},this.collapse_all=function(){n.find(".node-children").hide(),n.find(".node-expanded").hide(),n.find(".node-collapsed").show()},this.expand=function(e){var d=jQuery.Deferred();return a(e).done(function(){var o=n.find(".node[data-node="+e+"]");o.children(".node-body").find(".node-collapsed").hide(),o.children(".node-body").find(".node-expanded").show(),o.children(".node-children").show(),d.resolve()}).fail(function(){d.reject()}),d},this.expand_to=function(e){var d=jQuery.Deferred();return i.parent_nodes(e).done(function(e){var n=function(e){if(0==e.length)return void d.resolve();var i=e[0];e.shift(),o.expand(i.id).done(function(){n(e)}).fail(function(){d.reject()})};n(e)}).fail(function(){d.reject()}),d},this.select=function(e){this.expand_to(e).done(function(){n.find(".node.active").removeClass("active"),n.find(".node[data-node="+e+"]").addClass("active"),n.find("input").val(e)})},this.selection=function(){return n.find("input").val()},function(){0==n.find(".node-tree").size()&&n.append("<div class='node-tree'></div>"),n.find("input").change(function(){var e=o.selection();o.collapse_all(),o.select(e)}),i.root_node().done(function(e){t(e),o.select(o.selection())})}()};jQuery.fn.treeView=function(d,n){return this.each(function(){var o=jQuery.data(this,"treeView");"init"!=d||o?"collapse"==d?o.collapse(n):"collapse_all"==d?o.collapse_all():"unload_node"==d?o.unload_node(n):"expand"==d?o.expand(n):"expand_to"==d?o.expand_to(n):"select"==d?o.select(n):"selection"==d&&o.selection():(o=new e(this,n),jQuery.data(this,"treeView",o))}),this}}();